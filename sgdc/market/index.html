<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SGDC Live ‚Äî Market</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet"/>
<style>
  :root{
    --bg:#0E1023; --panel:#15193A; --card:#131736; --text:#E9ECFF; --muted:#A3A9D8;
    --good:#4BD37B; --bad:#FF6B6B; --pill:#FFFFFF1A; --border:#FFFFFF1A;
    --shadow:0 18px 40px rgba(0,0,0,.45);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,sans-serif;background:radial-gradient(1200px 600px at 10% -10%,#14183d 0,#0E1023 60%);color:var(--text)}
  .nav-wrap{position:sticky;top:0;z-index:40;background:rgba(20,24,49,.66);backdrop-filter:blur(12px);border-bottom:1px solid var(--border)}
  .nav{max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:12px;padding:12px 16px}
  .back{border:1px solid var(--border);background:#ffffff14;padding:8px 12px;border-radius:12px;text-decoration:none;color:var(--text);font-weight:600}
  .brand{font-weight:800;letter-spacing:.2px}
  .spacer{flex:1}
  .balance{font-weight:800;color:var(--good)}
  .container{max-width:1200px;margin:0 auto;padding:22px 16px 64px}
  .summary{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px}
  .box{background:linear-gradient(180deg,var(--panel),#111431);border:1px solid var(--border);border-radius:18px;padding:16px;box-shadow:var(--shadow)}
  .label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}
  .value{margin-top:6px;font-weight:800;font-size:22px}
  .tabs{display:flex;gap:8px;margin-top:18px}
  .tab{padding:10px 14px;border-radius:999px;border:1px solid var(--border);background:var(--pill);color:var(--text);cursor:pointer;font-weight:700}
  .tab.active{outline:2px solid #ffffff24;background:#ffffff24}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:18px;margin-top:18px}
  .card{background:linear-gradient(180deg,var(--card),#101432);border:1px solid var(--border);border-radius:18px;padding:14px;box-shadow:var(--shadow);text-decoration:none;color:var(--text);display:block;transition:transform .18s ease, border-color .18s ease}
  .card:hover{transform:translateY(-4px);border-color:#ffffff2e}
  .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
  .name{font-weight:800}
  .ticker{font-size:12px;color:var(--muted)}
  .pill{background:var(--pill);border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:12px}
  .pill.up{color:var(--good)} .pill.down{color:var(--bad)}
  .chip{border:1px solid #ffffff22;background:#ffffff10;padding:8px 12px;border-radius:12px}
  .pos-table{width:100%;border-collapse:collapse;margin-top:12px}
  .pos-table th,.pos-table td{padding:12px;border-bottom:1px dashed #ffffff1a;font-size:14px;text-align:left}
  .muted{color:var(--muted)}
  .hint{margin-top:14px;color:var(--muted)}
</style>
</head>
<body>
  <div class="nav-wrap">
    <nav class="nav">
      <a class="back" href="../">‚Üê Terug</a>
      <div class="brand">SGDC Live ‚Äî Market</div>
      <div class="spacer"></div>
      <div class="balance">Bits: <span id="bitsHeader">0</span></div>
    </nav>
  </div>

  <main class="container">
    <div class="summary">
      <div class="box" id="boxWallet">
        <div class="label">Wallet</div>
        <div class="value"><span id="bitsWallet">0</span> Bits</div>
      </div>
      <div class="box">
        <div class="label">Ge√Ønvesteerd</div>
        <div class="value"><span id="bitsInvested">0</span> Bits</div>
      </div>
      <div class="box">
        <div class="label">Markt t.o.v. gisteren</div>
        <div class="value"><span id="marketDelta">0.00%</span></div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" id="tabMarket">Markt</button>
      <button class="tab" id="tabWallet">Wallet</button>
    </div>

    <section id="marketView">
      <div class="grid" id="assetGrid"></div>
      <p class="hint">Klik op een coin voor details, grafiek, markers van je aankopen/verkopen en P/L.</p>
    </section>

    <section id="walletView" style="display:none;margin-top:12px">
      <div class="box">
        <div class="label">Overzicht</div>
        <div class="row" style="margin-top:10px;gap:12px;flex-wrap:wrap">
          <div class="chip">Vrij: <strong><span id="walletFree">0</span> Bits</strong></div>
          <div class="chip">Ge√Ønvesteerd: <strong><span id="walletLocked">0</span> Bits</strong></div>
          <div class="chip">Totaal: <strong><span id="walletTotal">0</span> Bits</strong></div>
        </div>
      </div>

      <div class="box" style="margin-top:12px">
        <div class="label">Posities</div>
        <table class="pos-table" id="posTable">
          <thead><tr>
            <th>Asset</th><th>Qty</th><th>Gem. prijs</th><th>Koers</th><th>P/L</th><th></th>
          </tr></thead>
          <tbody id="posBody"></tbody>
        </table>
      </div>
    </section>
  </main>

<script>
/* ===========================
   SGDC Market ‚Äî Single file
   v1.4 ‚Äî Bits sync + trades log
   =========================== */
const LS={ get(k,d){try{const v=localStorage.getItem(k);return v?JSON.parse(v):d}catch{return d}}, set(k,v){localStorage.setItem(k,JSON.stringify(v))} };
const bitsKey='sgdc.bits'; // gebruikt jouw Bits key
const assetsKey='market.assets', portfolioKey='portfolio', histPrefix='market.history.', tradesPrefix='market.trades.';
const Bits=(function(){ // exact samenwerken met je aangeleverde Bits-API
  const has=window.Bits&&typeof window.Bits.get==='function'&&typeof window.Bits.set==='function';
  const listeners=[]; function emit(v){listeners.forEach(fn=>{try{fn(v)}catch{}})}
  return {
    get(){return has?window.Bits.get():(Number(localStorage.getItem(bitsKey))||100)},
    set(v){ if(has) window.Bits.set(v); else localStorage.setItem(bitsKey,String(Math.max(0,Math.floor(v)))); emit(this.get()); },
    onChange(fn){ listeners.push(fn); if(has&&window.Bits.onChange) window.Bits.onChange(fn); else fn(this.get()); }
  };
})();
const Meta={SNK:{name:"Snacko",icon:"üç™",vol:.006,seed:95},FRIK:{name:"Frikandelium",icon:"üå≠",vol:.010,seed:42},COKE:{name:"ColaCap",icon:"ü•§",vol:.009,seed:60},BBIT:{name:"Bitterbit",icon:"üü§",vol:.007,seed:33},HWK:{name:"HwCoin",icon:"üìö",vol:.004,seed:21},TCH:{name:"TeachToken",icon:"üë©‚Äçüè´",vol:.008,seed:78},WIFI:{name:"LaggyFi",icon:"üì∂",vol:.012,seed:54},CHAIR:{name:"ChairChain",icon:"ü™ë",vol:.005,seed:18},CHZB:{name:"CheezeBread",icon:"üßÄ",vol:.003,seed:12},PPLX:{name:"PartyPlex",icon:"üéâ",vol:.015,seed:140}};
const Symbols=Object.keys(Meta);
let Assets={};
function Hhist(sym){return histPrefix+sym}
function Htr(sym){return tradesPrefix+sym}
function seedSeries(p0,vol,anchor){const N=2000,arr=new Array(N);let p=p0;for(let i=0;i<N;i++){const r=(Math.random()*2-1)*(vol*0.9),th=0.02;p=p*(1+r)+th*(anchor-p);const h=i%720;if(h>330&&h<390)p*=1.0004;if(h>650&&h<720)p*=0.9996;p=Math.max(1,+p.toFixed(2));arr[i]=p;}return arr;}
function initAssets(force=false){const existed=LS.get(assetsKey,null);if(existed&&!force){Assets=existed;Symbols.forEach(sym=>{ if(!LS.get(Hhist(sym),null)) LS.set(Hhist(sym), seedSeries(Assets[sym].price,Assets[sym].vol,Assets[sym].anchor)); if(!LS.get(Htr(sym),null)) LS.set(Htr(sym), []);});return;}
  const seeded={};Symbols.forEach(sym=>{const m=Meta[sym],p0=m.seed,anchor=p0,vol=m.vol;const yClose=+(p0*(1+(Math.random()*2-1)*0.02)).toFixed(2);LS.set(Hhist(sym),seedSeries(p0,vol,anchor));LS.set(Htr(sym),[]);seeded[sym]={price:p0,anchor,vol,yClose};});Assets=seeded;LS.set(assetsKey,Assets);}
function pushHistory(sym,price){const k=Hhist(sym),arr=LS.get(k,[]);arr.push(+price.toFixed(2));if(arr.length>3000)arr.shift();LS.set(k,arr);}
function history(sym){return LS.get(Hhist(sym),[])}
function trades(sym){return LS.get(Htr(sym),[])}
function addTrade(sym,trade){const arr=trades(sym);arr.push(trade);LS.set(Htr(sym),arr);}
function indexNowY(){const now=Symbols.reduce((s,k)=>s+Assets[k].price,0)/Symbols.length;const y=Symbols.reduce((s,k)=>s+Assets[k].yClose,0)/Symbols.length;return{now,y}}
function tickOne(sym){const a=Assets[sym];const r=(Math.random()*2-1)*a.vol,th=0.02;let p=a.price*(1+r)+th*(a.anchor-a.price);const t=new Date();const tmin=t.getHours()*60+t.getMinutes();if(sym==='SNK'||sym==='FRIK'){if((tmin>=630&&tmin<=660)||(tmin>=750&&tmin<=780))p*=1.0015}if(sym==='PPLX'){if(Math.random()<0.01)p*=1.008;if(Math.random()<0.01)p*=0.992}if(sym==='WIFI'){if(Math.random()<0.015)return;if(Math.random()<0.008)p*=(Math.random()<0.5?0.985:1.015)}a.price=Math.max(1,+p.toFixed(2));pushHistory(sym,a.price);}
function tickAll(){Symbols.forEach(tickOne);LS.set(assetsKey,Assets);}
const Fee=0.005;
function portfolio(){return LS.get(portfolioKey,{})}
function setPortfolio(p){LS.set(portfolioKey,p)}
function portfolioValue(){const p=portfolio();let s=0;for(const [sym,pos] of Object.entries(p)){if(!Assets[sym])continue;s+=pos.qty*Assets[sym].price;}return Math.floor(s)}
function buy(sym,qty){qty=Math.floor(qty);if(qty<=0)return{ok:false,msg:'Ongeldige hoeveelheid.'};const a=Assets[sym];if(!a)return{ok:false,msg:'Onbekend asset.'};const cost=Math.ceil(qty*a.price*(1+Fee));if(Bits.get()<cost)return{ok:false,msg:'Onvoldoende Bits.'};const hlen=history(sym).length;Bits.set(Bits.get()-cost);const p=portfolio();const pos=p[sym]||{qty:0,avg:0};const newQty=pos.qty+qty;const newAvg=(pos.qty*pos.avg+qty*a.price)/newQty;p[sym]={qty:newQty,avg:+newAvg.toFixed(2)};setPortfolio(p);addTrade(sym,{t:Date.now(),type:'buy',qty,price:a.price,idx:hlen-1});return{ok:true,msg:`Kocht ${qty} ${sym} @ ‚Çø${a.price.toFixed(2)} (fee ${(Fee*100).toFixed(2)}%)`};}
function sell(sym,qty){qty=Math.floor(qty);if(qty<=0)return{ok:false,msg:'Ongeldige hoeveelheid.'};const a=Assets[sym];if(!a)return{ok:false,msg:'Onbekend asset.'};const p=portfolio();const pos=p[sym];if(!pos||pos.qty<qty)return{ok:false,msg:'Niet genoeg positie.'};const hlen=history(sym).length;const proceeds=Math.floor(qty*a.price*(1-Fee));Bits.set(Bits.get()+proceeds);const newQty=pos.qty-qty;if(newQty<=0)delete p[sym];else p[sym]={qty:newQty,avg:pos.avg};setPortfolio(p);const pl=(a.price-pos.avg)*qty-(qty*a.price*Fee);addTrade(sym,{t:Date.now(),type:'sell',qty,price:a.price,idx:hlen-1});return{ok:true,msg:`Verkocht ${qty} ${sym} @ ‚Çø${a.price.toFixed(2)} (P/L ${pl>=0?'+':''}${pl.toFixed(2)})`};}
function fmt(n){return '‚Çø'+Number(n).toFixed(2)}
const E=id=>document.getElementById(id);

function renderSummary(){
  const b=Bits.get();E('bitsHeader').textContent=b;E('bitsWallet').textContent=b;
  const inv=portfolioValue();E('bitsInvested').textContent=inv;
  const {now,y}=indexNowY();const pct=((now-y)/y)*100;const el=E('marketDelta');el.textContent=(pct>=0?'+':'')+pct.toFixed(2)+'%';el.style.color=pct>=0?'var(--good)':'var(--bad)';
  E('walletFree').textContent=b;E('walletLocked').textContent=inv;E('walletTotal').textContent=b+inv;
}
function renderGrid(){
  const wrap=E('assetGrid');
  wrap.innerHTML=Symbols.map(sym=>{
    const a=Assets[sym],m=Meta[sym];const pct=((a.price-a.yClose)/a.yClose)*100;const cls=pct>=0?'up':'down';
    return `<a class="card" href="./asset.html?symbol=${encodeURIComponent(sym)}">
      <div class="row">
        <div style="display:flex;gap:10px;align-items:center">
          <div class="pill" style="border:none;background:#ffffff22">${m.icon}</div>
          <div><div class="name">${m.name}</div><div class="ticker">${sym}</div></div>
        </div>
        <div style="text-align:right">
          <div class="name">${fmt(a.price)}</div>
          <div class="pill ${cls}">${pct>=0?'+':''}${pct.toFixed(2)}%</div>
        </div>
      </div>
    </a>`;
  }).join('');
}
function renderPositions(){
  const body=E('posBody');const rows=[];
  for(const [sym,pos] of Object.entries(portfolio())){
    const a=Assets[sym];const plAbs=(a.price-pos.avg)*pos.qty;const plPct=(a.price-pos.avg)/pos.avg*100;
    rows.push(`<tr>
      <td><strong>${sym}</strong></td>
      <td>${pos.qty}</td>
      <td>${fmt(pos.avg)}</td>
      <td>${fmt(a.price)}</td>
      <td style="color:${plAbs>=0?'var(--good)':'var(--bad)'}">${plAbs>=0?'+':''}${plAbs.toFixed(2)} (${plPct>=0?'+':''}${plPct.toFixed(2)}%)</td>
      <td><a class="pill" href="./asset.html?symbol=${encodeURIComponent(sym)}">Beheer</a></td>
    </tr>`);
  }
  body.innerHTML=rows.length?rows.join(''):`<tr><td colspan="6" class="muted">Nog geen posities.</td></tr>`;
}

function boot(){
  const tabMarket=E('tabMarket'),tabWallet=E('tabWallet');
  const vMarket=E('marketView'),vWallet=E('walletView');
  const showMarket=()=>{tabMarket.classList.add('active');tabWallet.classList.remove('active');vMarket.style.display='block';vWallet.style.display='none';};
  const showWallet=()=>{tabWallet.classList.add('active');tabMarket.classList.remove('active');vWallet.style.display='block';vMarket.style.display='none';};
  tabMarket.onclick=showMarket;tabWallet.onclick=showWallet;E('boxWallet').onclick=showWallet;

  if(!localStorage.getItem(assetsKey)) Bits.set(Bits.get()); // force init Bits key
  initAssets();

  renderSummary();renderGrid();renderPositions();
  Bits.onChange(()=>renderSummary());

  setInterval(()=>tickAll(),2000);
  setInterval(()=>{ if(Math.random()<0.8){ renderSummary();renderGrid();renderPositions(); }},1500);
}
document.addEventListener('DOMContentLoaded',boot);
</script>
</body>
</html>
