<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SGDC Live ‚Äî Snake</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    :root{--bg:#0e1023;--panel:#171a37;--text:#e8ecff;--muted:#a2a9d6;--accent:#f4b73b;--good:#4bd37b;--warn:#ff6b6b;--border:rgba(255,255,255,.12);}
    *{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,sans-serif;background:var(--bg);color:var(--text)}
    .topbar{background:#171a37;display:flex;align-items:center;justify-content:space-between;padding:10px 16px;position:sticky;top:0}
    .brand{font-weight:700;display:flex;align-items:center;gap:10px}
    .brand img{width:28px;height:28px;border-radius:6px}
    .balance{font-weight:700;color:var(--good)}
    .ghost{background:transparent;border:1px solid var(--border);color:var(--text);padding:6px 12px;border-radius:8px;text-decoration:none}
    .wrap{max-width:720px;margin:20px auto;padding:0 16px}
    h1{margin-bottom:8px}
    .info{color:var(--muted);margin-bottom:12px}
    canvas{width:min(92vw,420px);height:min(92vw,420px);background:#0b0d25;border:1px solid var(--border);border-radius:12px;display:block;margin:20px auto}
    .controls{text-align:center;margin:12px 0}
    .btn{padding:8px 14px;border:none;border-radius:8px;font-weight:700;cursor:pointer;margin:0 4px}
    .btn.start{background:var(--accent);color:#2a1b00}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .toast{position:fixed;bottom:16px;right:16px;background:#1b233f;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;transition:.2s}
    .toast.show{opacity:1}
    #limitText{margin-top:6px;font-weight:600}
  </style>
</head>
<body>
  <!-- Bits script -->
  <script src="../js/bits.js"></script>

  <header class="topbar">
    <a href="../" class="ghost">‚Üê Terug</a>
    <div class="brand">
      <img src="https://groep8sgdc.nl/wp-content/uploads/2022/09/s-Gravendreef-scholen07-01-18-1.png" alt="SGDC logo">
      Snake
    </div>
    <div class="balance">Bits: <span id="bitsValue">0</span></div>
  </header>

  <main class="wrap">
    <h1>Snake</h1>
    <p class="info">
      Besturing: Pijltjes of WASD. Spatie = start/pauze. Elke üçé = +1 Bit.<br>
      Je kunt <b>maximaal 2 potjes per dag</b> spelen. Daarna wordt de startknop geblokkeerd.
    </p>

    <div class="controls">
      <button class="btn start" id="startBtn">Start potje</button>
      <button class="btn" id="pauseBtn">Pauze</button>
      <button class="btn" id="resetBtn">Opnieuw</button>
    </div>

    <div class="info">
      Score: <span id="score">0</span> ¬∑ Verdiend dit potje: <span id="earned">0</span> Bits
    </div>
    <canvas id="game" width="336" height="336"></canvas>
    <p id="limitText"></p>
  </main>

  <div class="toast" id="toast"></div>

<script>
  // Bits live sync
  Bits.onChange(v => { document.getElementById("bitsValue").textContent = v; });

  // Daglimiet
  const LIMIT = 2;
  const todayKey = "snake.plays." + new Date().toISOString().slice(0,10);
  let playsToday = Number(localStorage.getItem(todayKey) || 0);
  function savePlay(){ playsToday++; localStorage.setItem(todayKey, playsToday); renderLimit(); }
  function renderLimit(){
    const left = Math.max(0, LIMIT - playsToday);
    const txt = document.getElementById("limitText");
    if(left>0){ txt.textContent = `Daglimiet: ${LIMIT} potjes ‚Äî nog ${left} over vandaag`; txt.style.color="var(--good)"; }
    else{ txt.textContent = `Daglimiet bereikt ‚Äî kom morgen terug`; txt.style.color="var(--warn)"; }
    document.getElementById("startBtn").disabled = (left<=0);
  }
  renderLimit();

  // Snake logica
  const cvs = document.getElementById("game");
  const ctx = cvs.getContext("2d");
  const scoreEl = document.getElementById("score");
  const earnedEl = document.getElementById("earned");
  const grid = 21, cell = cvs.width/grid;
  let loopId=null, dir={x:1,y:0}, nextDir={x:1,y:0}, speed=120;
  let snake, apple, score, earned, paused;

  function rnd(n){ return Math.floor(Math.random()*n); }
  function placeApple(){ let a; do{ a={x:rnd(grid), y:rnd(grid)}; }while(snake.some(s=>s.x===a.x&&s.y===a.y)); apple=a; }
  function resetGame(){ snake=[{x:10,y:10}]; dir={x:1,y:0}; nextDir={x:1,y:0}; score=0; earned=0; paused=true; placeApple(); draw(); updateUI(); }
  function updateUI(){ scoreEl.textContent=score; earnedEl.textContent=earned; }
  function draw(){
    ctx.fillStyle="#0b0d25"; ctx.fillRect(0,0,cvs.width,cvs.height);
    ctx.strokeStyle="rgba(255,255,255,.05)";
    ctx.beginPath(); for(let i=0;i<=grid;i++){ ctx.moveTo(i*cell,0); ctx.lineTo(i*cell,grid*cell); ctx.moveTo(0,i*cell); ctx.lineTo(grid*cell,i*cell);} ctx.stroke();
    ctx.fillStyle="#ff4d4d"; ctx.beginPath(); ctx.arc((apple.x+.5)*cell,(apple.y+.5)*cell,cell*.35,0,Math.PI*2); ctx.fill();
    for(let i=0;i<snake.length;i++){ const s=snake[i]; ctx.fillStyle=i===0?"#8a7cff":"#6476ff"; ctx.fillRect(s.x*cell+1,s.y*cell+1,cell-2,cell-2); }
  }
  function step(){
    if(paused) return;
    dir=nextDir;
    const head={x:(snake[0].x+dir.x+grid)%grid,y:(snake[0].y+dir.y+grid)%grid};
    if(snake.some((s,i)=>i>0&&s.x===head.x&&s.y===head.y)){ pause(); return; }
    snake.unshift(head);
    if(head.x===apple.x&&head.y===apple.y){ score++; earned++; Bits.add(1); showToast("+1 Bit"); placeApple(); }
    else{ snake.pop(); }
    draw(); updateUI();
  }
  function loop(){ step(); loopId=setTimeout(loop,speed); }
  function start(){ if(loopId) return; paused=false; cvs.focus(); loop(); savePlay(); }
  function pause(){ paused=true; clearTimeout(loopId); loopId=null; }

  document.getElementById("startBtn").onclick=()=>{ start(); renderLimit(); };
  document.getElementById("pauseBtn").onclick=()=>pause();
  document.getElementById("resetBtn").onclick=()=>resetGame();

  window.addEventListener("keydown",e=>{
    const k=e.key.toLowerCase();
    if(["arrowup","w"].includes(k)&&dir.y!==1) nextDir={x:0,y:-1};
    else if(["arrowdown","s"].includes(k)&&dir.y!==-1) nextDir={x:0,y:1};
    else if(["arrowleft","a"].includes(k)&&dir.x!==1) nextDir={x:-1,y:0};
    else if(["arrowright","d"].includes(k)&&dir.x!==-1) nextDir={x:1,y:0};
    else if(k===" "){ paused?start():pause(); }
  });

  function showToast(msg){
    const t=document.getElementById("toast");
    t.textContent=msg; t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"),1200);
  }

  resetGame();
</script>
</body>
</html>
