<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lucas Terminal</title>

  <style>
    :root { --green: #66ff66; }

    * { box-sizing: border-box; }

    body {
      background-color: #000;
      background: radial-gradient(#177317, #000);
      box-shadow: inset 0 0 30rem #000000;
      color: var(--green);
      font-family: "VT323", monospace;
      font-size: 1.4rem;
      padding: 1rem;
      margin: 0;
      overflow: hidden;
      height: 100vh;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    #terminal-history {
      list-style: none;
      padding-left: 0;
      margin: 0;
      max-height: calc(100vh - 6.25rem);
      overflow-y: auto;
    }

    #terminal-input {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-top: 1rem;
    }

    #prompt {
      opacity: 0.95;
      white-space: nowrap;
    }

    #terminal-text {
      flex: 1;
      white-space: pre-wrap;
      min-height: 1.5rem;
    }

    #caret {
      background-color: var(--green);
      width: 8px;
      height: 1.5rem;
      animation: blink 1s steps(5, start) infinite;
    }

    @keyframes blink { to { visibility: hidden; } }

    #alert {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      font-size: 3rem;
      display: none;
      animation: blink 1s steps(5, start) infinite;
    }
    #alert.active { display: block; }

    /* Onzichtbaar maar focusbaar: mobile keyboard */
    #mobile-capture {
      position: fixed;
      left: 0;
      bottom: 0;
      width: 1px;
      height: 1px;
      opacity: 0;
      border: 0;
      padding: 0;
      background: transparent;
      color: transparent;
      caret-color: transparent;
    }

    .ascii {
      white-space: pre;
      font-size: clamp(8px, 1.6vw, 14px);
      line-height: 1.1;
    }

    .dim { opacity: 0.85; }
  </style>
</head>

<body>
  <ul id="terminal-history"></ul>

  <div id="terminal-input">
    <span id="prompt"></span>
    <span id="terminal-text"></span>
    <span id="caret"></span>
  </div>

  <div id="alert">ABORT...</div>
  <input id="mobile-capture" autocomplete="off" autocapitalize="none" autocorrect="off" spellcheck="false" />

  <script>
    const historyEl = document.getElementById("terminal-history");
    const terminalText = document.getElementById("terminal-text");
    const promptEl = document.getElementById("prompt");
    const alertBox = document.getElementById("alert");
    const mobileCapture = document.getElementById("mobile-capture");

    const routes = {
      "portfolio": "https://lucasmangroelal.nl/portfolio",
      "linkedin": "https://nl.linkedin.com/in/lucas-mangroelal-4b458b348"
    };

    // Tiny fake filesystem voor secret commands
    const FS = {
      "/": { type: "dir", children: {
        "home": { type: "dir", children: {
          "lucas": { type: "dir", children: {
            "README.txt": { type: "file", content:
`Lucas OS â€” Secret Mode

Probeer:
- ls
- cd vault
- cat hint.txt

(ja dit is nep, maar wel leuk ðŸ˜‰)`},
            "vault": { type: "dir", children: {
              "hint.txt": { type: "file", content:
`Tip: sommige dingen zijn "locked" ðŸ‘€
probeer: sudo cat flag.txt` },
              "flag.txt": { type: "file", content:
`Permission denied: nice try ðŸ˜‰` }
            }}
          }}
        }},
        "etc": { type: "dir", children: {
          "motd": { type: "file", content: "Message of the day: keep shipping." }
        }}
      }}
    };

    let cwd = "/home/lucas";
    let pendingAction = null;
    let currentText = "";

    // Detect touch device (voor mobile keyboard fix + voorkomen van dubbel typen)
    const isTouchDevice =
      ("ontouchstart" in window) ||
      (navigator.maxTouchPoints && navigator.maxTouchPoints > 0);

    function addLine(text, className = "") {
      const li = document.createElement("li");
      if (className) li.className = className;
      li.textContent = text;
      historyEl.appendChild(li);
      historyEl.scrollTop = historyEl.scrollHeight;
    }

    function addAscii(text) {
      const li = document.createElement("li");
      const pre = document.createElement("pre");
      pre.className = "ascii";
      pre.textContent = text;
      li.appendChild(pre);
      historyEl.appendChild(li);
      historyEl.scrollTop = historyEl.scrollHeight;
    }

    function clearScreen() {
      historyEl.innerHTML = "";
    }

    function updatePrompt() {
      promptEl.textContent = "> ";
    }

    function bar(pct, width = 10) {
      return "â–ˆ".repeat(Math.round(pct / 100 * width)) +
             "â–‘".repeat(width - Math.round(pct / 100 * width));
    }

    function cmd_status() {
      addLine(`CPU: ${bar(72)} 72%`);
      addLine(`RAM: ${bar(41)} 41%`);
    }

    function askLinkedInConfirm() {
      addLine("Dit opent mijn LinkedIn-profiel.");
      addLine("Voeg me gelijk toe als connectie als je toch een kijkje neemt.");
      addLine('Typ "y" om door te gaan:');
      pendingAction = "linkedin";
    }

    // ===== HELP OUTPUTS =====
    function cmd_help_normal() {
      addLine("Commands:");
      addLine(" - 1           : open mijn portfolio");
      addLine(" - 2 / linkedin: open mijn LinkedIn (met confirm)");
      addLine(" - status      : systeemstatus");
      addLine(" - clear       : maak scherm leeg");
      addLine(" - help        : toon deze lijst");
      addLine(' - secret      : toon secret commands');
      addLine("");
      addLine('Tip: typ "secret" als je de easter eggs wil zien.');
    }

    function cmd_help_secret() {
      addLine("Secret commands (easter eggs):");
      addLine(" - ls            : toon mappen/bestanden");
      addLine(" - cd <map>      : ga naar map (cd .. / cd / / cd ~)");
      addLine(" - pwd           : huidige locatie");
      addLine(" - cat <file>    : lees bestand");
      addLine(" - tree          : mappenboom (kort)");
      addLine(" - ping <site>   : neppe ping");
      addLine(" - sudo <cmd>    : Permission denied: nice try ðŸ˜‰");
      addLine(" - whoami        : ???");
      addLine(" - date          : tijd/datum");
      addLine(" - echo <tekst>  : print tekst");
      addLine(" - glitch        : ???");
      addLine("");
      addLine('Try: ls â†’ cd vault â†’ cat hint.txt', "dim");
    }

    // ===== Fake FS helpers =====
    function normalizePath(p) {
      const parts = p.split("/").filter(Boolean);
      const stack = [];
      for (const part of parts) {
        if (part === ".") continue;
        if (part === "..") stack.pop();
        else stack.push(part);
      }
      return "/" + stack.join("/");
    }

    function pathJoin(base, part) {
      if (part.startsWith("/")) return normalizePath(part);
      if (base === "/") return normalizePath("/" + part);
      return normalizePath(base + "/" + part);
    }

    function getNode(path) {
      const norm = normalizePath(path);
      const parts = norm.split("/").filter(Boolean);
      let node = FS["/"];
      for (const part of parts) {
        if (!node || node.type !== "dir") return null;
        node = node.children?.[part];
      }
      return node || null;
    }

    function cmd_ls(args) {
      const target = args[0] ? pathJoin(cwd, args[0]) : cwd;
      const node = getNode(target);
      if (!node) return addLine("ls: No such file or directory");
      if (node.type !== "dir") return addLine("ls: Not a directory");
      const names = Object.keys(node.children || {}).sort((a,b)=>a.localeCompare(b));
      addLine(names.join("  "));
    }

    function cmd_pwd() { addLine(cwd); }

    function cmd_cd(args) {
      const raw = args[0] || "~";
      let target;
      if (raw === "~" || raw === "") target = "/home/lucas";
      else if (raw === "/") target = "/";
      else target = pathJoin(cwd, raw);

      const node = getNode(target);
      if (!node) return addLine(`cd: no such file or directory: ${raw}`);
      if (node.type !== "dir") return addLine(`cd: not a directory: ${raw}`);
      cwd = normalizePath(target);
    }

    function cmd_cat(args) {
      const raw = args[0];
      if (!raw) return addLine("cat: missing file operand");
      const target = pathJoin(cwd, raw);
      const node = getNode(target);
      if (!node) return addLine(`cat: no such file: ${raw}`);
      if (node.type !== "file") return addLine(`cat: not a file: ${raw}`);

      // extra: block flag content always
      if (normalizePath(target).endsWith("/flag.txt")) {
        addLine("Permission denied: nice try ðŸ˜‰");
        return;
      }

      node.content.split("\n").forEach(line => addLine(line));
    }

    function cmd_tree() {
      function walk(path, depth, prefix) {
        const node = getNode(path);
        if (!node || node.type !== "dir") return;
        const names = Object.keys(node.children || {}).sort((a,b)=>a.localeCompare(b));
        const shown = names.slice(0, 12);
        shown.forEach((name, idx) => {
          const isLast = idx === shown.length - 1;
          const branch = isLast ? "â””â”€" : "â”œâ”€";
          const child = node.children[name];
          addLine(`${prefix}${branch} ${name}${child.type === "dir" ? "/" : ""}`);
          if (child.type === "dir" && depth < 2) {
            walk(pathJoin(path, name), depth + 1, prefix + (isLast ? "   " : "â”‚  "));
          }
        });
        if (names.length > shown.length) addLine(`${prefix}â””â”€ ...`);
      }
      addLine(`${cwd}/`);
      walk(cwd, 0, "");
    }

    function cmd_ping(args) {
      const host = args[0];
      if (!host) return addLine("ping: missing host");
      addLine(`PING ${host} (192.0.2.${Math.floor(Math.random()*200+1)}): 56 data bytes`);
      const times = [12, 9, 18, 7].map(t => t + Math.floor(Math.random()*8));
      times.forEach((t, i) => addLine(`64 bytes from ${host}: icmp_seq=${i+1} ttl=57 time=${t}.0 ms`));
      addLine(`--- ${host} ping statistics ---`);
      addLine(`4 packets transmitted, 4 received, 0% packet loss`);
    }

    function cmd_sudo(rawOriginal) {
      const after = rawOriginal.replace(/^sudo\s+/i, "");
      if (!after) return addLine("sudo: no command specified");
      addLine("sudo: Permission denied: nice try ðŸ˜‰");
    }

    function cmd_whoami() { addLine("guest"); }
    function cmd_date() { addLine(new Date().toString()); }
    function cmd_echo(args) { addLine(args.join(" ")); }

    function runCommand(inputRaw) {
      const raw = inputRaw.trim();
      const input = raw.toLowerCase();
      if (!raw) return;

      addLine(`> ${raw}`);

      if (pendingAction === "linkedin") {
        if (input === "y") window.location.href = routes.linkedin;
        else addLine("Geannuleerd.");
        pendingAction = null;
        return;
      }

      const parts = raw.split(" ").filter(Boolean);
      const cmd = (parts.shift() || "").toLowerCase();
      const args = parts;

      // normal commands
      if (cmd === "help" || cmd === "?") return cmd_help_normal();
      if (cmd === "secret") return cmd_help_secret();
      if (cmd === "status") return cmd_status();
      if (cmd === "clear") return clearScreen();
      if (cmd === "1") return window.location.href = routes.portfolio;
      if (cmd === "2" || cmd === "linkedin") return askLinkedInConfirm();
      if (cmd === "glitch") return alertBox.classList.add("active");

      // secret commands (user has to know them)
      if (cmd === "ls") return cmd_ls(args);
      if (cmd === "cd") return cmd_cd(args);
      if (cmd === "pwd") return cmd_pwd();
      if (cmd === "cat") return cmd_cat(args);
      if (cmd === "tree") return cmd_tree();
      if (cmd === "ping") return cmd_ping(args);
      if (cmd === "sudo") return cmd_sudo(raw);
      if (cmd === "whoami") return cmd_whoami();
      if (cmd === "date") return cmd_date();
      if (cmd === "echo") return cmd_echo(args);

      addLine(`Command not found: ${raw}`);
      addLine(`Tip: 1, 2, help`, "dim");
    }

    function render() {
      terminalText.textContent = currentText;
    }

    function submit() {
      runCommand(currentText);
      currentText = "";
      render();
      focusMobileKeyboard();
    }

    function focusMobileKeyboard() {
      if (!isTouchDevice) return;
      mobileCapture.focus({ preventScroll: true });
    }

    // âœ… Desktop keyboard (NIET op touch devices â†’ voorkomt dubbel typen)
    window.addEventListener("keydown", e => {
      if (isTouchDevice) return;

      if (e.key === "Enter") submit();
      else if (e.key === "Backspace") currentText = currentText.slice(0, -1);
      else if (e.key.length === 1) currentText += e.key;
      render();
    });

    // Mobiel: software keyboard
    mobileCapture.addEventListener("input", () => {
      const v = mobileCapture.value;
      if (!v) return;

      for (const ch of v) {
        if (ch === "\n") submit();
        else currentText += ch;
      }
      mobileCapture.value = "";
      render();
    });

    mobileCapture.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        submit();
      } else if (e.key === "Backspace") {
        currentText = currentText.slice(0, -1);
        render();
      }
    });

    document.addEventListener("pointerdown", () => focusMobileKeyboard());
    document.addEventListener("visibilitychange", () => {
      if (!document.hidden) focusMobileKeyboard();
    });

    function boot() {
      updatePrompt();

      const bootLines = [
        "Booting system...",
        "Loading config...",
        "Ready.",
        "",
        "Voer het nummer in van je keuze:",
        "[1] Bekijk mijn portfolio",
        "[2] Bekijk mijn LinkedIn",
        "",
        'Typ "help" voor commands.'
      ];

      bootLines.forEach((l, i) => setTimeout(() => addLine(l), i * 280));
      setTimeout(cmd_status, bootLines.length * 280 + 200);

      setTimeout(() => addAscii(
`â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•    â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•
â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘    â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•     â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•`),
        bootLines.length * 280 + 650
      );

      setTimeout(() => focusMobileKeyboard(), 100);
    }

    boot();
    render();
  </script>
</body>
</html>
